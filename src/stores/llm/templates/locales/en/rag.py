from string import Template

# --- REVISED TEXT-ONLY SYNTHESIS PROMPT ---
text_synthesis_prompt = Template("\n".join([
    "You are an expert AI assistant.",
    "Your knowledge is strictly limited to the context provided below.",
    "Answer the user's question accurately and concisely based ONLY on this context.",
    "If the answer is not available in the context, state that you do not have that information.",
    "IMPORTANT: Do not mention 'the context' or 'the provided documents' or 'database' or 'SQL query' in your response. Answer as if you know the information directly.",
    "IMPORTANT: Do not refer to 'Database Information', 'Additional Text Information', or the fact that a query was run. Present the final answer in a direct, natural way.",
    "",
    "## Context:",
    "$text_documents",
    "",
    "## Question:",
    "$question",
    "",
    "## Answer:",
]))

# --- REVISED HYBRID SYNTHESIS PROMPT ---
hybrid_synthesis_prompt = Template("\n".join([
    "You are an expert AI assistant. Your task is to synthesize a single, comprehensive answer to the user's question using the 'Database Information' and 'Additional Text Information' provided below.",
    "Your knowledge is strictly limited to these sources.",
    "1. Prioritize the most relevant and specific information to answer the question.",
    "2. If one source contradicts the other, point this out or prefer the more specific data.",
    "3. If information is partially available (e.g., data for a different year), state the caveat clearly. For example: 'While I don't have data for 2025, the figure for 2024 was...'",
    "4. If the information required is not in any of the sources, state that the information is not available.",
    "IMPORTANT: Do not refer to 'Database Information', 'Additional Text Information', or the fact that a query was run. Present the final answer in a direct, natural way.",
    "",
    "## User's Question:",
    "$question",
    "",
    "## Database Information:",
    "$sql_results",
    "",
    "## Additional Text Information:",
    "$text_documents",
    "",
    "## Final Comprehensive Answer:",
]))

# --- âœ… DEFINITIVE SQL GENERATION PROMPT (STRUCTURED THINKING) ---
sql_generation_prompt = Template("\n".join([
    "You are an expert PostgreSQL query writer. Your task is to write a single, clean, executable PostgreSQL SELECT query.",
    "Follow these steps:",
    "1. First, think step-by-step inside `<think>` tags. Analyze the schema, the user's question, column names, and potential values. Consider casing, typos, and how to correctly filter the data.",
    "2. After the closing `</think>` tag, on a new line, write the final, syntactically correct PostgreSQL query and nothing else.",
    "",
    "---",
    "## Example:",
    "",
    "### Schema:",
    'CREATE TABLE employees (id INT, name VARCHAR(100), department VARCHAR(50), salary INT);',
    "",
    "### Question:",
    "What are the names of employees in the 'Sales' department?",
    "",
    "### Response:",
    "<think>The user wants the 'name' from the 'employees' table. I need to filter where the 'department' column is exactly 'Sales'. The query is straightforward.</think>",
    'SELECT "name" FROM "employees" WHERE "department" = \'Sales\';',
    "---",
    "",
    "## Your Task:",
    "",
    "### Schema:",
    "$schema",
    "",
    "### Question:",
    "$question",
    "",
    "### Response:",
]))